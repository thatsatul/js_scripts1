<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
 
<head>
  <title>Intersection observer</title>
  <style>
    .full-screen {
      width: 100%;
      height: 200vh;
      background-color: blue;
    }
    .test {
      width: 100%;
      height: 50px;
      background-color: red;
    }
    .dynamic {
      width: 100%;
      height: 50px;
      background-color: green;
    }
  </style>
</head>

<body>
  <div class="full-screen"></div>
  <div class="test"></div>
  <script>

    /**
     * The options for the observer.
     * 50px 0px on the rootMargin says that the observer triggers
     * after 50px in the top and bottom.
     */
    // const options = {
    //   root: null,
    //   rootMargin: '50px 0px',
    //   threshold: [0]
    // };

    const options = {
      root: null,
      rootMargin: '0px',
      threshold: 1.0
    }

    const onIntersection = (entries, observer) => {
      for (const { isIntersecting, target } of entries) {
        if (isIntersecting) {
          addDiv();
          // observer.unobserve(target);
        }
      }
    };

    const observer = new IntersectionObserver(onIntersection, options)
    observer.observe(document.querySelector('.test'))

    function addDiv() {
      console.log(123);
      const d = document.createElement('div');
      d.classList.add('dynamic');
      document.body.appendChild(d);
    }
  </script>
</body>

</html>